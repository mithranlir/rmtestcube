<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<measures xmlns="http://www.quartetfs.com"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.quartetfs.com ../activepivot-types.xsd">
	
	<nativeMeasure name="contributors.COUNT" alias="Count" formatter="INT[#,###]" />
	<nativeMeasure name="update.TIMESTAMP" alias="Timestamp" formatter="DATE[HH:mm:ss]" />

	<!-- SUM is the default aggregation function. The default name is 'field'.'aggregation'. -->
	<measure field="delta" 	folder="Sensitivities" formatter="DOUBLE[#,###.0000;-#,###.00]" />
	<measure field="gamma" 	folder="Sensitivities" formatter="DOUBLE[#,###.0000;-#,###.00]" />
	<measure field="vega" 	folder="Sensitivities" formatter="DOUBLE[#,###.0000;-#,###.00]" />
	<measure field="theta" 	folder="Sensitivities" formatter="DOUBLE[#,###.0000;-#,###.00]" />
	<measure field="rho" 	folder="Sensitivities" formatter="DOUBLE[#,###.0000;-#,###.00]" />
	<!-- The pv measure is an alias of productBaseMtm this measure will be 
		seen as pv in your front end notice that you should link this measure with 
		field attribute to the available field productBaseMtm. -->
	<measure name="pv.SUM" field="productBaseMtm" aggregation="SUM" folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" />
	<measure field="pnl" 		folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" />
	<measure field="pnlDelta" 	folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" />
	<measure field="pnlVega" 	folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" />
	
	<!-- This post processor dynamically buckets an underlying measure -->
	<!-- It works together with a dynamic bucket hierarchy. -->
	<postProcessor name="pv.bucket.SUM" pluginKey="TIME_BUCKETER" underlyingMeasures="pv.SUM" folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" continuousQueryHandlers="UPDATE_ANALYSIS_HIERARCHY">
		<properties>
			<entry key="bucketHierarchy" value="TimeBucketDynamic@Time" />
			<entry key="bucketedLevel" value="Value Date@TimeBucket@Time" />
		</properties>
	</postProcessor>
	
	<!-- The pv.UnderlyingsRatio measure is a post-processed measure thanks 
		to the formula aggregatedValue[pv.SUM],parentAggregatedValue[pv.SUM::1],/ 
		which is a Reverse Polish notation. The goal of this post-processed measure 
		is to figure out the ratio of a child to its parent against the hierarchy 
		1 (thanks to the operand parentAggregatedValue) -->
	<postProcessor name="pv.UnderlyingsRatio" pluginKey="FORMULA" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]">
		<properties>
			<entry key="formula" value="aggregatedValue[pv.SUM],parentAggregatedValue[pv.SUM::Underlyings],/" />
		</properties>
	</postProcessor>
	
	<!-- This post processor dynamically buckets an underlying measure -->
	<!-- It works together with a dynamic bucket hierarchy. -->
	<postProcessor name="pnl.bucket.SUM" pluginKey="TIME_BUCKETER" underlyingMeasures="pnl.SUM" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]" continuousQueryHandlers="UPDATE_ANALYSIS_HIERARCHY">
		<properties>
			<entry key="bucketHierarchy" value="TimeBucketDynamic@Time" />
			<entry key="bucketedLevel" value="Value Date@TimeBucket@Time" />
		</properties>
	</postProcessor>
	
	<postProcessor name="pnl.MINIMUM_DEPTH" pluginKey="MINIMUM_DEPTH" underlyingMeasures="pnl.SUM" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]">
		<properties>
			<entry key="hierarchyName" value="Underlyings" />
		</properties>
	</postProcessor>
	
	<postProcessor name="pnl.FOREX" pluginKey="FOREX" underlyingMeasures="pnl.SUM" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]" continuousQueryHandlers="STORED, FOREX">
		<properties>
			<entry key="leafLevels" value="UnderlierCurrency@Underlyings@Underlyings" />
		</properties>
	</postProcessor>
	
	<!-- Add a distributed post processor for the pnl.FOREX measure because it is datastore aware and must be executed locally -->
	<postProcessor name="pnl.Distributed_Forex" pluginKey="SIMPLE_DISTRIBUTED" underlyingMeasures="pnl.FOREX" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]" continuousQueryHandlers="STORED, FOREX"/>
	
	<postProcessor name="pnlDelta.bucket.SUM" pluginKey="TIME_BUCKETER" underlyingMeasures="pnlDelta.SUM" folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" continuousQueryHandlers="UPDATE_ANALYSIS_HIERARCHY">
		<properties>
			<entry key="bucketHierarchy" value="TimeBucketDynamic@Time" />
			<entry key="bucketedLevel" value="Value Date@TimeBucket@Time" />
		</properties>
	</postProcessor>
	
	<postProcessor name="pnlVega.bucket.SUM" pluginKey="TIME_BUCKETER" underlyingMeasures="pnlVega.SUM" folder="PnL" formatter="DOUBLE[#,###.00;-#,###.00]" continuousQueryHandlers="UPDATE_ANALYSIS_HIERARCHY">
		<properties>
			<entry key="bucketHierarchy" value="TimeBucketDynamic@Time" />
			<entry key="bucketedLevel" value="Value Date@TimeBucket@Time" />
		</properties>
	</postProcessor>
	
	<postProcessor pluginKey="PNL_KPI_GOAL" name="PnL Limit"
		underlyingMeasures="pnl.SUM" formatter="DOUBLE[#,###.##]" 
		continuousQueryHandlers="STORED" visible="false">
		<!-- It defines the post-processor but this can only be accessed through the kpi -->
		<properties/>
	</postProcessor>


	<postProcessor pluginKey="PNL_KPI_STATUS" name="PnL Limit Status"
		underlyingMeasures="pnl.SUM,PnL Limit" formatter="DOUBLE[#,###.##]" 
		continuousQueryHandlers="STORED" visible="false">
		<properties />
	</postProcessor>


	<postProcessor name="pnl.REF_FOREX" pluginKey="REF_FOREX" underlyingMeasures="pnl.SUM" folder="PnL" formatter="DOUBLE[#,###.0000;-#,###.0000]">
		<properties>
			<entry key="leafLevels" value="UnderlierCurrency@Underlyings@Underlyings" />
		</properties>
	</postProcessor>

</measures>